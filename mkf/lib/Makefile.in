top_builddir = ..
top_srcdir = @top_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@

CC = @CC@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

PREFIX = $(DESTDIR)$(prefix)
LIBDIR = $(DESTDIR)$(libdir)
INCDIR = $(DESTDIR)$(prefix)/include

VPATH = $(top_srcdir)/lib

INCDIR_TMP = $(top_builddir)/include

CFLAGS = $(CFLAGS_LOCAL) @DEB_CFLAGS@ @KIK_CFLAGS@ @TABLE_CFLAGS@ @CFLAGS@ @CPPFLAGS@ -I/usr/local/include
LIBS = $(LIBS_LOCAL)

PARSER_OBJ = mkf_parser.o mkf_iso2022_parser.o mkf_iso8859_parser.o mkf_xct_parser.o \
	mkf_eucjp_parser.o mkf_euckr_parser.o mkf_euccn_parser.o mkf_iso2022jp_parser.o \
	mkf_iso2022kr_parser.o mkf_sjis_parser.o mkf_big5_parser.o mkf_euctw_parser.o \
	mkf_utf16_parser.o mkf_iso2022cn_parser.o mkf_hz_parser.o mkf_utf8_parser.o \
	mkf_johab_parser.o mkf_viscii_parser.o mkf_8bit_parser.o mkf_iscii_parser.o \
	mkf_utf32_parser.o

CONV_OBJ = mkf_iso8859_conv.o mkf_iso2022_conv.o mkf_iso2022jp_conv.o mkf_iso2022kr_conv.o \
	mkf_sjis_conv.o mkf_utf8_conv.o mkf_big5_conv.o mkf_euctw_conv.o mkf_iso2022cn_conv.o \
	mkf_hz_conv.o mkf_utf16_conv.o mkf_eucjp_conv.o mkf_euckr_conv.o mkf_euccn_conv.o \
	mkf_johab_conv.o mkf_viscii_conv.o mkf_8bit_conv.o mkf_xct_conv.o mkf_iscii_conv.o \
	mkf_utf32_conv.o

MAP_OBJ = mkf_ucs4_map.o mkf_locale_ucs4_map.o mkf_zh_cn_map.o mkf_zh_tw_map.o mkf_zh_hk_map.o \
	mkf_ko_kr_map.o mkf_viet_map.o mkf_ja_jp_map.o mkf_ru_map.o mkf_uk_map.o mkf_tg_map.o

PROP_OBJ = mkf_ucs_property.o mkf_jisx0208_1983_property.o mkf_jisx0213_2000_property.o

UCS_TABLE_OBJ = mkf_ucs4_usascii.o mkf_ucs4_iso8859.o mkf_ucs4_viscii.o mkf_ucs4_tcvn5712_1.o \
	mkf_ucs4_koi8.o mkf_ucs4_georgian_ps.o mkf_ucs4_cp1251.o mkf_ucs4_cp1255.o \
	mkf_ucs4_jisx0201.o mkf_ucs4_jisx0208.o mkf_ucs4_jisx0212.o \
	mkf_ucs4_jisx0213.o mkf_ucs4_ksc5601.o mkf_ucs4_uhc.o mkf_ucs4_johab.o \
	mkf_ucs4_gb2312.o mkf_ucs4_gbk.o mkf_ucs4_big5.o mkf_ucs4_cns11643.o \
	mkf_gb18030_2000_intern.o

OBJ = $(PARSER_OBJ) $(CONV_OBJ) $(MAP_OBJ) mkf_char.o mkf_sjis_env.o $(PROP_OBJ) $(UCS_TABLE_OBJ)

INC = $(PARSER_OBJ:.o=.h) $(CONV_OBJ:.o=.h) $(MAP_OBJ:.o=.h) mkf_char.h mkf_sjis_env.h \
	mkf_property.h mkf_ucs_property.h mkf_charset.h mkf_conv.h

LIBNAME = libmkf
LIBNAME_DEB = libmkf_deb
MAJOR = 13
MINOR = 0

LIBTOOL_CC = $(LIBTOOL) --mode=compile $(CC) $(CFLAGS)
LIBTOOL_LINK = $(LIBTOOL) --mode=link $(CC) -L${top_builddir}/kiklib/src/.libs
LIBTOOL_INSTALL = $(LIBTOOL) --mode=install $(INSTALL)


all : $(LIBNAME).la collect-headers

debug :
	$(MAKE) LIBNAME=$(LIBNAME_DEB) $(LIBNAME_DEB).a

$(LIBNAME).a : $(OBJ)
	$(LIBTOOL_LINK) -o $(LIBNAME).a $(OBJ)

$(LIBNAME).la : $(OBJ)
	$(LIBTOOL_LINK) -o $(LIBNAME).la $(OBJ:.o=.lo) -rpath $(PREFIX)/lib \
		-no-undefined \
		-version-info $(MAJOR):$(MINOR):0 \
		${top_builddir}/kiklib/src/libkik.la

$(INCDIR_TMP)/mkf :
	mkdir -p $(INCDIR_TMP)/mkf

collect-headers : $(INCDIR_TMP)/mkf
	for file in $(INC) ; do cp $(top_srcdir)/lib/$${file} $(INCDIR_TMP)/mkf ; done

install: install-inc install-la

install-deb :
	$(MAKE) LIBNAME=$(LIBNAME_DEB) install-ar

install-inc : $(INCDIR)/mkf
	cp $(INCDIR_TMP)/mkf/*.h $(INCDIR)/mkf

install-la : $(LIBDIR)
	$(LIBTOOL_INSTALL) *.la $(LIBDIR)

install-ar : $(LIBDIR)
	$(LIBTOOL_INSTALL) *.a $(LIBDIR)

$(INCDIR)/mkf :
	mkdir -p $(INCDIR)/mkf

$(LIBDIR) :
	mkdir -p $(LIBDIR)

clean :
	rm -rf $(OBJ) $(OBJ:.o=.lo) .libs *.la *.a $(INCDIR_TMP)

.SUFFIXES : .c.o

.c.o :
	$(LIBTOOL_CC) -c $<
