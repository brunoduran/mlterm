BUILD_TOPDIR = ..

prefix = @prefix@
sysconfdir = @sysconfdir@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
libexecdir = @libexecdir@

SRC_TOPDIR = @SRC_TOPDIR@

CC = @CC@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

PREFIX = $(DESTDIR)$(prefix)
BINDIR = $(DESTDIR)$(bindir)
LIBDIR = $(DESTDIR)$(libdir)
SYSCONFDIR = $(sysconfdir)
LIBEXECDIR = $(libexecdir)

VPATH = $(SRC_TOPDIR)/src

OBJ = ml_window_manager.o ml_window.o ml_char.o ml_image.o ml_logs.o ml_line_hints.o \
	ml_vt100_parser.o ml_pty.o ml_image_intern.o ml_image_scroll.o \
	ml_selection.o ml_term_screen.o ml_xim.o ml_xic.o ml_color_manager.o \
	ml_term_model.o ml_image_line.o main.o ml_font_manager.o ml_scrollbar.o \
	ml_sb_term_screen.o ml_picture.o ml_keymap.o ml_font.o ml_config_menu.o \
	ml_term_manager.o ml_char_encoding.o ml_font_custom.o ml_sb_view_factory.o \
	ml_simple_sb_view.o ml_color.o ml_termcap.o ml_bidi.o ml_shaping.o \
	ml_str_parser.o ml_sig_child.o ml_iscii.o ml_logical_visual.o ml_mod_meta_mode.o \
	ml_bel_mode.o ml_sb_mode.o ml_decsp_font.o ml_color_custom.o ml_image_model.o \
	ml_picture_dep.o

LKIK = @KIK_LIBS@
LMKF = @MKF_LIBS@
LKIK_DEB = -lkik_deb
LMKF_DEB = -lmkf_deb

CFLAGS=$(CFLAGS_LOCAL) @KIK_CFLAGS@ @MKF_CFLAGS@ @DEB_CFLAGS@ @IMLIB_CFLAGS@ @FRIBIDI_CFLAGS@ \
	@GDK_PIXBUF_CFLAGS@ @AA_CFLAGS@ @UCS4_CFLAGS@ @IND_CFLAGS@ @UTMP_CFLAGS@ @XUTF8_CFLAGS@ @CFLAGS@ \
	-DLIBDIR=\"$(LIBDIR)\" -DLIBEXECDIR=\"$(LIBEXECDIR)\" -DSYSCONFDIR=\"$(SYSCONFDIR)\" \
	-I/usr/X11R6/include -I/usr/local/include
LIBS=$(LIBS_LOCAL) @FRIBIDI_LIBS@ @IMLIB_LIBS@ @AA_LIBS@ @IND_LIBS@ @GDK_PIXBUF_LIBS@ \
	@X_EXTRA_LIBS@ -lX11 $(LKIK) $(LMKF) \
	-L/usr/X11R6/lib -L/usr/local/lib -R/usr/X11R6/lib -R/usr/local/lib

PROG = mlterm
INSTALL_OPT = @INSTALL_OPT@

LIBTOOL_LINK = $(LIBTOOL) --mode=link $(CC)
LIBTOOL_INSTALL = $(LIBTOOL) --mode=install $(INSTALL)

all: $(PROG)

debug:	
	$(MAKE) LKIK="$(LKIK_DEB)" LMKF="$(LMKF_DEB)" all

$(PROG): $(OBJ)
	$(LIBTOOL_LINK) $(CFLAGS) -o $(PROG) $(OBJ) $(LIBS)

.SUFFIXES: .c .o

.c.o:
	$(CC) $(CFLAGS) -c $<

$(BINDIR):
	mkdir -p $(BINDIR)

install : $(BINDIR)
	$(LIBTOOL_INSTALL) $(INSTALL_OPT) $(PROG) $(BINDIR)

wc :
	find . -name "*.[ch]" -a \! -name "test_*" | xargs wc -l

clean:
	rm -rf $(PROG) *.core $(OBJ) .libs

