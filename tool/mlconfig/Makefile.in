BUILD_TOPDIR = ../..

prefix = @prefix@
exec_prefix = @exec_prefix@
libexecdir = @libexecdir@
sysconfdir = @sysconfdir@

SRC_TOPDIR = @SRC_TOPDIR@

VPATH = ${SRC_TOPDIR}/tool/mlconfig

CC = @CC@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

DESTDIR =
LIBEXECDIR = $(DESTDIR)$(libexecdir)
SYSCONFDIR = $(DESTDIR)$(sysconfdir)

LKIK = @KIK_LIBS@

GTK_CONFIG=@GTK_CONFIG@
CFLAGS = `$(GTK_CONFIG) --cflags` $(CFLAGS_LOCAL) \
	@FRIBIDI_CFLAGS@ @IND_CFLAGS@ @AA_CFLAGS@ @GDK_PIXBUF_CFLAGS@ \
	@IMLIB_CFLAGS@ \
	@DEB_CFLAGS@ @KIK_CFLAGS@ @MKF_CFLAGS@ @CFLAGS@ \
	-I${SRC_TOPDIR}/xwindow -I${SRC_TOPDIR}/mlterm -I/usr/X11R6/include -I/usr/local/include \
	-DSYSCONFDIR=\"$(SYSCONFDIR)\"
LIBS = `$(GTK_CONFIG) --libs` $(LIBS_LOCAL) $(LKIK) \
	-L/usr/X11R6/lib -L/usr/local/lib -R/usr/X11R6/lib -R/usr/local/lib

LIBTOOL_LINK = $(LIBTOOL) --mode=link $(CC)
LIBTOOL_INSTALL = $(LIBTOOL) --mode=install $(INSTALL)

OBJ = main.o mc_combo.o mc_char_encoding.o mc_xim.o mc_tabsize.o mc_logsize.o mc_check.o \
	mc_fontsize.o mc_color.o mc_mod_meta.o mc_bel.o mc_iscii_lang.o \
	mc_fade.o mc_brightness.o mc_contrast.o mc_gamma.o mc_screen_ratio.o \
	mc_line_space.o mc_vertical.o mc_sb.o mc_sb_view.o mc_wall_pic.o \
	mc_bgtype.o mc_io.o

LKIK_DEB=-lkik_deb

all: mlconfig

debug:
	$(MAKE) LKIK="$(LKIK_DEB)" all

mlconfig: $(OBJ)
	$(LIBTOOL_LINK) $(OBJ) $(CFLAGS) -o mlconfig $(LIBS)

.c.o:
	$(CC) $(CFLAGS) -c $<

install: $(LIBEXECDIR)
	$(LIBTOOL_INSTALL) -m 755 mlconfig $(LIBEXECDIR)

$(LIBEXECDIR):
	mkdir -p $(LIBEXECDIR)

clean:
	rm -rf $(OBJ) mlconfig *.core .libs
