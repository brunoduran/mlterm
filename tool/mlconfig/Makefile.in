top_builddir = ../..
top_srcdir = @top_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
datadir = @datadir@
libexecdir = @libexecdir@
sysconfdir = @sysconfdir@
datadir = @datadir@

VPATH = ${top_srcdir}/tool/mlconfig

CC = @CC@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

DESTDIR =
DATADIR = $(DESTDIR)$(datadir)
LIBEXECDIR = $(DESTDIR)$(libexecdir)
SYSCONFDIR = $(DESTDIR)$(sysconfdir)
LOCALEDIR = $(DESTDIR)$(datadir)/locale

LKIK = @KIK_LIBS@

GTK_CONFIG=@GTK_CONFIG@
CFLAGS = `$(GTK_CONFIG) --cflags` $(CFLAGS_LOCAL) \
	@FRIBIDI_CFLAGS@ @IND_CFLAGS@ @AA_CFLAGS@ @IMAGELIB_CFLAGS@ \
	@DEB_CFLAGS@ @KIK_CFLAGS@ @MKF_CFLAGS@ @CFLAGS@ @CPPFLAGS@ \
	-I${top_srcdir}/xwindow -I${top_srcdir}/mlterm \
	-I${top_builddir}/common -I${top_srcdir}/common \
	-I/usr/X11R6/include -I/usr/local/include \
	-DSYSCONFDIR=\"$(SYSCONFDIR)\" -DLOCALEDIR=\"$(LOCALEDIR)\" \
	-DDATADIR=\"$(DATADIR)\"	
LIBS = @INTL_LIBS@ @DL_SELF@ `$(GTK_CONFIG) --libs` $(LIBS_LOCAL) $(LKIK) \
	-L/usr/X11R6/lib -L/usr/local/lib -R/usr/X11R6/lib -R/usr/local/lib

LIBTOOL_LINK = $(LIBTOOL) --mode=link $(CC)
LIBTOOL_INSTALL = $(LIBTOOL) --mode=install $(INSTALL)

PACKAGE = @PACKAGE@
VERSION = @VERSION@

OBJ = main.o mc_combo.o mc_char_encoding.o mc_xim.o mc_tabsize.o mc_logsize.o mc_check.o \
	mc_fontsize.o mc_color.o mc_mod_meta.o mc_bel.o mc_iscii_lang.o \
	mc_fade.o mc_brightness.o mc_contrast.o mc_gamma.o mc_screen_ratio.o \
	mc_line_space.o mc_vertical.o mc_sb.o mc_sb_view.o mc_wall_pic.o \
	mc_bgtype.o mc_io.o mc_pty.o mc_flags.o

LKIK_DEB=-lkik_deb

all: mlconfig

debug:
	$(MAKE) LKIK="$(LKIK_DEB)" all

mlconfig: $(OBJ)
	$(LIBTOOL_LINK) $(OBJ) $(CFLAGS) -o mlconfig $(LIBS)
	cd po ; $(MAKE) update-gmo
	# cd po ; $(MAKE) update-po

.c.o:
	$(CC) $(DEFS) $(CFLAGS) -c $<

install: $(LIBEXECDIR)
	$(LIBTOOL_INSTALL) -m 755 mlconfig $(LIBEXECDIR)
	cd po ; $(MAKE) install

$(LIBEXECDIR):
	mkdir -p $(LIBEXECDIR)

clean:
	rm -rf $(OBJ) mlconfig mlconfig.exe *.core .libs
	cd po ; $(MAKE) clean

distclean: clean
	rm -f Makefile
	cd po ; $(MAKE) maintainer-clean
