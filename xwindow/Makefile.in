top_builddir = ..
top_srcdir = @top_srcdir@
prefix = @prefix@
sysconfdir = @sysconfdir@
exec_prefix = @exec_prefix@
datadir = @datadir@
bindir = @bindir@
libdir = @libdir@
libexecdir = @libexecdir@

CC = @CC@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@

PREFIX = $(DESTDIR)$(prefix)
BINDIR = $(DESTDIR)$(bindir)
LIBDIR = $(DESTDIR)$(libdir)
DATADIR = $(DESTDIR)$(datadir)
SYSCONFDIR = $(sysconfdir)
LIBEXECDIR = $(libexecdir)

VPATH = $(top_srcdir)/xwindow

OBJ1 = x_term_manager.o x_display@WIN32TAG@.o x_window@WIN32TAG@.o x_screen.o x_xic@WIN32TAG@.o \
	x_color_manager.o x_font_manager.o x_picture.o x_font@WIN32TAG@.o x_color@WIN32TAG@.o \
	x_selection.o x_font_config.o x_color_config.o x_main_config.o \
	x_shortcut.o x_bel_mode.o x_sb_mode.o x_mod_meta_mode.o main.o \
	x_termcap.o x_font_cache.o x_draw_str.o x_gc.o x_color_cache.o \
	x_scrollbar.o x_sb_screen.o x_sb_view_factory.o x_simple_sb_view@WIN32TAG@.o

OBJ2 = x_decsp_font.o @DND_LIBS@ x_im.o x_im_candidate_screen.o \
	x_im_status_screen.o x_imagelib_@IMAGELIB_NAME@.o x_xim.o

OBJ2_win32 = x_imagelib_win32.o x_gdiobj_pool.o

OBJ = $(OBJ1) $(OBJ2@WIN32TAG@)

LKIK = @LKIK@
LMKF = @LMKF@
LMLTERM = ../mlterm/libmlterm.a
LKIK_DEB = -lkik_deb
LMKF_DEB = -lmkf_deb

CFLAGS = $(CFLAGS_LOCAL) @AA_CFLAGS@ @KIK_CFLAGS@ @MKF_CFLAGS@ @DEB_CFLAGS@ \
	@FRIBIDI_CFLAGS@ @IND_CFLAGS@ @IMAGELIB_CFLAGS@ @X_CFLAGS@ @GUI_CFLAGS@ \
	@XUTF8_CFLAGS@ @DND_CFLAGS@ @IM_CFLAGS@ @CFLAGS@ @CPPFLAGS@ \
	-DLIBDIR=\"$(LIBDIR)\" -DSYSCONFDIR=\"$(SYSCONFDIR)\" \
	-DLIBEXECDIR=\"$(LIBEXECDIR)\" -DDATADIR=\"$(DATADIR)\"\
	-I$(top_srcdir)/mlterm -I${top_builddir}/xwindow -I/usr/local/include

LIBS1 = $(LIBS_LOCAL) $(LMLTERM) $(LMKF) $(LKIK) \
	-L/usr/local/lib -R/usr/local/lib

LIBS2 = @IND_LIBS@ @FRIBIDI_LIBS@ @IMAGELIB_LIBS@ @AA_LIBS@ \
	@DL_LIBS_IM@ @DL_LIBS_SB@ \
	@X_LIBS@ @X_PRE_LIBS@ -lX11 @X_EXTRA_LIBS@ 

LIBS2_win32 = -mwindows -limm32 @SUBSYSTEM@

LIBS = $(LIBS1) $(LIBS2@WIN32TAG@)

PROG = mlterm
INSTALL_OPT = @INSTALL_OPT@

LIBTOOL_LINK = $(LIBTOOL) --mode=link $(CC)
LIBTOOL_INSTALL = $(LIBTOOL) --mode=install $(INSTALL)

all: $(PROG)

debug:
	$(MAKE) LKIK="$(LKIK_DEB)" LMKF="$(LMKF_DEB)" all

$(PROG): $(OBJ) $(LMLTERM)
	$(LIBTOOL_LINK) $(CFLAGS) -o $(PROG) $(OBJ) $(LIBS)

.SUFFIXES: .c .o

.c.o:
	$(CC) $(CFLAGS) -c $<

$(BINDIR):
	mkdir -p $(BINDIR)

install : $(BINDIR)
	$(LIBTOOL_INSTALL) $(INSTALL_OPT) $(PROG) $(BINDIR)

wc :
	find . -name "*.[ch]" -a \! -name "test_*" | xargs wc -l

clean:
	rm -rf $(PROG) $(PROG).exe *.core $(OBJ) .libs

distclean: clean
	rm -f Makefile
